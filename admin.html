<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel - PowerMax</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; background: #0b1224; color: #fff; padding: 20px; }
h2 { color: #38bdf8; text-align: center; margin-bottom: 20px; }
table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
th, td { padding: 10px; border: 1px solid #fff; text-align: left; }
th { background: #2563eb; }
button { padding: 6px 12px; margin: 2px; border: none; border-radius: 5px; cursor: pointer; }
.approve { background: #22c55e; color: #020617; }
.reject { background: #ef4444; color: #fff; }
</style>
</head>
<body>

<h2>⚡ Admin Panel - PowerMax ⚡</h2>

<h3>Deposit Requests</h3>
<table id="depositTable">
  <tr>
    <th>User ID</th>
    <th>Amount (PTS)</th>
    <th>Wallet</th>
    <th>Wallet Number</th>
    <th>Status</th>
    <th>Action</th>
  </tr>
</table>

<h3>Withdraw Requests</h3>
<table id="withdrawTable">
  <tr>
    <th>User ID</th>
    <th>Amount (PTS)</th>
    <th>Wallet</th>
    <th>Wallet Number</th>
    <th>Status</th>
    <th>Action</th>
  </tr>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAuzjRv0Q1N4az6WPAQpGffAtZGT3Z-GxA",
  authDomain: "powermax-3ea77.firebaseapp.com",
  projectId: "powermax-3ea77",
  storageBucket: "powermax-3ea77.firebasestorage.app",
  messagingSenderId: "382941878878",
  appId: "1:382941878878:web:4472ab183d1534077732cf"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ===== Load Deposit Requests =====
async function loadDeposits() {
  const depositTable = document.getElementById("depositTable");
  const snapshot = await getDocs(collection(db, "depositRequests"));
  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    const row = depositTable.insertRow();
    row.innerHTML = `
      <td>${data.userId}</td>
      <td>${data.amount}</td>
      <td>${data.wallet}</td>
      <td>${data.walletNumber}</td>
      <td>${data.status}</td>
      <td>
        <button class="approve" onclick="approveDeposit('${docSnap.id}', ${data.amount}, '${data.userId}')">Approve</button>
        <button class="reject" onclick="rejectDeposit('${docSnap.id}')">Reject</button>
      </td>
    `;
  });
}

// ===== Approve / Reject Deposit =====
async function approveDeposit(docId, amount, userId) {
  const userRef = doc(db, "users", userId);
  const userSnap = await getDocs(collection(db, "users"));
  const userDoc = doc(db, "users", userId);
  await updateDoc(userDoc, { balance: (userSnap.data()?.balance || 0) + amount });
  await updateDoc(doc(db, "depositRequests", docId), { status: "Approved" });
  alert("Deposit Approved");
  location.reload();
}

async function rejectDeposit(docId) {
  await updateDoc(doc(db, "depositRequests", docId), { status: "Rejected" });
  alert("Deposit Rejected");
  location.reload();
}

// ===== Load Withdraw Requests =====
async function loadWithdraws() {
  const withdrawTable = document.getElementById("withdrawTable");
  const snapshot = await getDocs(collection(db, "withdrawRequests"));
  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    const row = withdrawTable.insertRow();
    row.innerHTML = `
      <td>${data.userId}</td>
      <td>${data.amount}</td>
      <td>${data.wallet}</td>
      <td>${data.walletNumber}</td>
      <td>${data.status}</td>
      <td>
        <button class="approve" onclick="approveWithdraw('${docSnap.id}', ${data.amount}, '${data.userId}')">Approve</button>
        <button class="reject" onclick="rejectWithdraw('${docSnap.id}')">Reject</button>
      </td>
    `;
  });
}

// ===== Approve / Reject Withdraw =====
async function approveWithdraw(docId, amount, userId) {
  const userDoc = doc(db, "users", userId);
  const userSnap = await getDocs(collection(db, "users"));
  const userBalance = userSnap.data()?.balance || 0;
  if (userBalance < amount) { alert("Insufficient Balance"); return; }
  await updateDoc(userDoc, { balance: userBalance - amount });
  await updateDoc(doc(db, "withdrawRequests", docId), { status: "Approved" });
  alert("Withdraw Approved");
  location.reload();
}

async function rejectWithdraw(docId) {
  await updateDoc(doc(db, "withdrawRequests", docId), { status: "Rejected" });
  alert("Withdraw Rejected");
  location.reload();
}

// ===== Load all requests =====
loadDeposits();
loadWithdraws();

</script>
</body>
</html>
