<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PowerMax Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{background:#020617;color:white;font-family:system-ui;text-align:center;padding:10px}
#wheel{width:300px;height:300px;border-radius:50%;margin:auto;border:8px solid white;
background:conic-gradient(red,yellow,green,cyan,blue,purple,orange,green);
transition:5s}
#pointer{width:0;height:0;border-left:15px solid transparent;border-right:15px solid transparent;border-bottom:30px solid white;margin:auto}
button{padding:12px 20px;margin:5px;border:none;border-radius:10px;font-size:16px;font-weight:bold}
#spinBtn{background:#22c55e}
.card{border:1px solid #334155;padding:10px;margin:10px;border-radius:10px}
</style>
</head>
<body>

<h2>âš¡ PowerMax Spin Game</h2>

<div>ðŸ’° Balance: <span id="balance">0</span> Points</div>
<div>ðŸŽ¯ Spins Left: <span id="spins">5</span></div>

<div id="pointer"></div>
<div id="wheel"></div>

<button id="spinBtn">ðŸŽ¡ SPIN</button>

<div class="card">
Referral Link:<br>
<input id="refLink" style="width:100%" readonly>
<button onclick="copyRef()">Copy</button>
</div>

<div class="card">
Total Referrals: <span id="refCount">0</span>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
 apiKey: "AIzaSyAuzjRv0Q1N4az6WPAQpGffAtZGT3Z-GxA",
 authDomain: "powermax-3ea77.firebaseapp.com",
 projectId: "powermax-3ea77"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// GET UID
const uid = localStorage.getItem("uid");
if(!uid){ location.href="index.html"; }

const userRef = doc(db,"users",uid);
let balance=0;
let spins=5;
let todayPoints=0;
const MAX=500;

// BASE URL
const baseUrl="https://powermaxearning.github.io/powermax/";

// LOAD USER
async function loadUser(){
 const snap = await getDoc(userRef);
 const data = snap.data();

 balance = data.balance || 0;
 spins = data.spins || 5;

 document.getElementById("balance").innerText=balance;
 document.getElementById("spins").innerText=spins;
 document.getElementById("refCount").innerText=data.refCount||0;

 document.getElementById("refLink").value= baseUrl+"?ref="+uid;
}
loadUser();

// COPY
window.copyRef=()=>{
 navigator.clipboard.writeText(document.getElementById("refLink").value);
 alert("Copied!");
};

// SPIN
document.getElementById("spinBtn").onclick=async()=>{
 if(spins<=0){ alert("No spins left"); return; }

 let rewards=[20,50,80,100];
 let reward=rewards[Math.floor(Math.random()*rewards.length)];

 if(todayPoints+reward>MAX) reward=MAX-todayPoints;
 todayPoints+=reward;

 spins--;
 document.getElementById("spins").innerText=spins;

 let deg=3600+Math.random()*360;
 document.getElementById("wheel").style.transform="rotate("+deg+"deg)";

 setTimeout(async()=>{
  balance+=reward;
  await updateDoc(userRef,{balance,spins});
  document.getElementById("balance").innerText=balance;
  alert("You got "+reward+" points!");
 },5000);
};
</script>

</body>
</html>
