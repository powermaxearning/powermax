<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PowerMax Casino Spin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{background:#020617;color:white;font-family:sans-serif;text-align:center}
.top{font-size:20px;margin:8px}
#wheelBox{position:relative;width:300px;margin:auto}
#wheel{
width:300px;height:300px;border-radius:50%;
background:conic-gradient(#ff0000,#ffea00,#00ff00,#00ffff,#0000ff,#ff00ff,#ff8800,#00ff00);
border:10px solid #fff;transition:5s cubic-bezier(.17,.67,.83,.67)
}
#pointer{
position:absolute;top:-20px;left:50%;transform:translateX(-50%);
width:0;height:0;border-left:15px solid transparent;border-right:15px solid transparent;border-bottom:30px solid white;
}
button{
padding:12px 20px;margin:6px;border:none;border-radius:10px;font-size:16px;font-weight:bold;cursor:pointer
}
#spinBtn{background:#22c55e}
#adSpin{background:#facc15}
#rewardBtn{background:#38bdf8}
.card{border:1px solid #334155;margin:10px;padding:10px;border-radius:10px}
small{color:#94a3b8}
</style>
</head>

<body>

<div class="top">ğŸ’° Balance: <span id="balance">0</span> Points</div>
<div class="top">ğŸ¯ Spins Left Today: <span id="spins">5</span></div>

<div id="wheelBox">
<div id="pointer"></div>
<div id="wheel"></div>
</div>

<button id="spinBtn">ğŸ¡ SPIN</button>
<button id="adSpin">â–¶ Watch Ad for Extra Spin</button>
<button id="rewardBtn">ğŸ Rewards (Min 15000 Points)</button>

<div class="card">
ğŸ”— Referral Link:<br>
<span id="refLink"></span><br>
<button onclick="copyRef()">Copy</button>
</div>

<div class="card">
ğŸ‘¥ Total Referrals: <span id="refCount">0</span>
</div>

<small>Points have no real cash value. Rewards are promotional only.</small>

<audio id="spinSound" src="https://assets.mixkit.co/sfx/preview/mixkit-casino-wheel-1990.mp3"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAuzjRv0Q1N4az6WPAQpGffAtZGT3Z-GxA",
  authDomain: "powermax-3ea77.firebaseapp.com",
  projectId: "powermax-3ea77"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const uid = localStorage.getItem("uid");
const userRef = doc(db,"users",uid);

let balance=0, spins=5;
const MAX_POINTS=500;
let todayPoints=0;

// LOAD USER
async function loadUser(){
 const snap = await getDoc(userRef);
 const data = snap.data();
 balance=data.balance||0;
 spins=data.spins||5;

 document.getElementById("balance").innerText=balance;
 document.getElementById("spins").innerText=spins;
 document.getElementById("refCount").innerText=data.refCount||0;
 document.getElementById("refLink").innerText=location.origin+"/index.html?ref="+uid;
}
loadUser();

// COPY REF
window.copyRef=()=>{
 navigator.clipboard.writeText(document.getElementById("refLink").innerText);
 alert("Referral Link Copied!");
};

// SPIN FUNCTION
document.getElementById("spinBtn").onclick = async ()=>{
 if(spins<=0){alert("No spins left today");return;}

 let rewards=[20,50,80,100];
 let reward=rewards[Math.floor(Math.random()*rewards.length)];
 if(todayPoints+reward>MAX_POINTS) reward=MAX_POINTS-todayPoints;
 todayPoints+=reward;

 spins--;
 document.getElementById("spins").innerText=spins;
 document.getElementById("spinSound").play();

 let deg=3600+Math.random()*360;
 document.getElementById("wheel").style.transform="rotate("+deg+"deg)";

 setTimeout(async ()=>{
  balance+=reward;
  await updateDoc(userRef,{balance,spins});
  document.getElementById("balance").innerText=balance;
  alert("ğŸ‰ You won "+reward+" points!");
 },5000);
};

// EXTRA SPIN BY AD
document.getElementById("adSpin").onclick=async ()=>{
 // ÛŒÛØ§Úº Adsterra ad code Ù„Ú¯Ø§Ù†Ø§
 spins++;
 await updateDoc(userRef,{spins});
 document.getElementById("spins").innerText=spins;
 alert("Extra Spin Added!");
};

// REWARDS
document.getElementById("rewardBtn").onclick=()=>{
 if(balance<15000){alert("Need 15000 Points");return;}
 alert("Reward request submitted for review");
};
</script>

</body>
</html>
