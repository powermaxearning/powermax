 <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PowerMax Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
}

/* ===== BODY ===== */
body{
  background:linear-gradient(180deg,#020617,#0b1224,#020617);
  color:#f8fafc;
}

/* ===== CONTAINER ===== */
.container{
  max-width:420px;
  margin:auto;
  padding:20px 14px 40px;
}

/* ===== TITLE ===== */
.dash-title{
  text-align:center;
  font-size:24px;
  font-weight:800;
  color:#38bdf8;
  margin-bottom:16px;
}

/* ===== USER CARD ===== */
.user-card{
  background:rgba(255,255,255,0.07);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:18px;
  padding:16px;
  text-align:center;
  margin-bottom:18px;
}

.user-card p{
  margin:6px 0;
  font-size:14px;
  color:#e5e7eb;
}

/* ===== PLANT CARD ===== */
.plant{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px;
  border-radius:16px;
  margin-bottom:12px;
}

.plant h3{
  font-size:16px;
  font-weight:700;
  margin-bottom:4px;
}

.plant p{
  font-size:13px;
  opacity:0.9;
}

/* ===== ACTIVATE BUTTON ===== */
.activate{
  background:rgba(255,255,255,0.25);
  border:none;
  padding:8px 16px;
  border-radius:20px;
  font-size:13px;
  font-weight:700;
  cursor:pointer;
}

/* ===== PLANT COLORS ===== */
.green{background:linear-gradient(135deg,#16a34a,#22c55e);}
.yellow{background:linear-gradient(135deg,#ca8a04,#facc15);}
.purple{background:linear-gradient(135deg,#7c3aed,#a855f7);}
.blue{background:linear-gradient(135deg,#0284c7,#38bdf8);}
.lavender{background:linear-gradient(135deg,#6d28d9,#c084fc);}
.pink{background:linear-gradient(135deg,#be185d,#f472b6);}
.mint{background:linear-gradient(135deg,#0f766e,#2dd4bf);}
.gray{background:linear-gradient(135deg,#334155,#64748b);}

/* ===== BUTTON ROW ===== */
.btn-row{
  display:flex;
  gap:12px;
  margin-top:14px;
}

/* ===== BUTTON ===== */
.btn{
  flex:1;
  padding:14px;
  border-radius:16px;
  border:none;
  font-size:15px;
  font-weight:700;
  cursor:pointer;
}

/* ===== BUTTON COLORS ===== */
.purple-btn{background:#a855f7;color:#fff;}
.teal-btn{background:#2dd4bf;color:#020617;}
.orange-btn{background:#fb923c;color:#020617;}
.green-btn{background:#22c55e;color:#020617;}
.red-btn{background:#f43f5e;color:#fff;}

/* ===== FULL ===== */
.full{
  width:100%;
  margin-top:12px;
}
/* ===== REFERRAL MODAL ===== */
.ref-modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999;
}

.ref-box{
  background:#ffffff;
  width:92%;
  max-width:380px;
  border-radius:18px;
  padding:20px;
  color:#020617;
}

.ref-title{
  font-size:18px;
  font-weight:800;
  color:#2563eb;
}

.ref-sub{
  font-size:13px;
  margin:6px 0 12px;
  color:#475569;
}

.ref-label{
  font-size:13px;
  font-weight:700;
}

.ref-link{
  display:flex;
  gap:8px;
  margin:8px 0 14px;
}

.ref-link input{
  flex:1;
  padding:8px;
  border-radius:10px;
  border:1px solid #cbd5f5;
}

.copy-btn{
  background:#22c55e;
  border:none;
  color:#fff;
  padding:8px 14px;
  border-radius:10px;
  font-weight:700;
}

.level{
  margin-top:12px;
  font-size:14px;
}

.l1{color:#16a34a;}
.l2{color:#dc2626;}

.level-box{
  background:#ecfdf5;
  border-radius:12px;
  padding:14px;
  text-align:center;
  font-size:13px;
  margin-top:6px;
}

.close-ref{
  margin-top:16px;
  width:100%;
  padding:12px;
  border-radius:14px;
  border:2px solid #64748b;
  background:#fff;
  font-weight:700;
}
/* ===== DEPOSIT MODAL ===== */
.dep-modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999;
}
.status-btn {
  background: #2563eb; /* ŸÜ€åŸÑÿß ÿ®ŸπŸÜ */
  color: #fff;
  border: none;
  padding: 8px 16px; /* ŸÖŸÜÿßÿ≥ÿ® ÿ≥ÿßÿ¶ÿ≤ */
  border-radius: 12px;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  margin-bottom: 12px; /* Deposit Chips ⁄©€í ÿßŸàŸæÿ± ÿ¨⁄Ø€Å */
  display: inline-block;
}
.dep-box{
  background:#ffffff;
  width:92%;
  max-width:380px;
  border-radius:18px;
  padding:20px;
  color:#020617;
}

.dep-title{
  font-size:18px;
  font-weight:800;
  color:#2563eb;
  margin-bottom:10px;
}

.dep-field{
  margin-bottom:12px;
}

.dep-field label{
  font-size:13px;
  font-weight:700;
}

.dep-field select,
.dep-field input{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:1px solid #cbd5f5;
  margin-top:6px;
}

.wallet-row{
  display:flex;
  gap:8px;
}

.wallet-row input{
  flex:1;
}

.dep-actions{
  display:flex;
  gap:10px;
  margin-top:14px;
}

.confirm-btn{
  flex:1;
  background:linear-gradient(135deg,#ef4444,#f97316);
  border:none;
  color:#fff;
  padding:12px;
  border-radius:14px;
  font-weight:800;
}

.cancel-btn{
  flex:1;
  background:#fff;
  border:2px solid #64748b;
  padding:12px;
  border-radius:14px;
  font-weight:800;
}
</style>
</head>

<body>

<div class="container">

<h2 class="dash-title">‚ö° PowerMax Dashboard ‚ö°</h2>

<!-- USER INFO -->
<div class="user-card">
  <p><b>User ID:</b> <span id="uID">...</span></p>
  <p><b>Balance:</b> <span id="uBalance">...</span></p>
  <p><b>Name:</b> <span id="uName">...</span></p>
</div>

<!-- PLANTS -->
<div class="plant green">
  <div>
    <h3>50 PTS Plant</h3>
    <p>Commission 90%</p>
  </div>
  <button class="activate" data-amount="50">Activate</button>
</div>

<div class="plant yellow">
  <div>
    <h3>100 PTS Plant</h3>
    <p>Commission 90%</p>
  </div>
  <button class="activate" data-amount="100">Activate</button>
</div>

<div class="plant purple">
  <div>
    <h3>300 PTS Plant</h3>
    <p>Commission 90%</p>
  </div>
  <button class="activate" data-amount="300">Activate</button>
</div>

<div class="plant blue">
  <div>
    <h3>500 PTS Plant</h3>
    <p>Commission 90%</p>
  </div>
  <button class="activate" data-amount="500">Activate</button>
</div>

<div class="plant lavender">
  <div>
    <h3>1000 PTS Plant</h3>
    <p>Commission 90%</p>
  </div>
  <button class="activate" data-amount="1000">Activate</button>
</div>

<div class="plant pink">
  <div>
    <h3>2000 PTS Plant</h3>
    <p>Commission 90%</p>
  </div>
  <button class="activate" data-amount="2000">Activate</button>
</div>

<div class="plant mint">
  <div>
    <h3>3000 PTS Plant</h3>
    <p>Commission 90%</p>
  </div>
  <button class="activate" data-amount="3000">Activate</button>
</div>

<div class="plant gray">
  <div>
    <h3>5000 PTS Plant</h3>
    <p>Commission 90%</p>
  </div>
  <button class="activate" data-amount="5000">Activate</button>
</div>

<!-- ACTION BUTTONS -->
<div class="btn-row">
  <button class="btn purple-btn" id="openReferral">Refer & Earn</button>
  <button class="btn teal-btn" id="openDeposit">Deposit</button>
</div>

<div class="btn-row">
  <button class="btn orange-btn" id="openWithdraw">Withdraw</button>
  <button class="btn teal-btn" id="openHistory">History</button>
</div>

<button class="btn green-btn full">WhatsApp Support</button>
<button class="btn red-btn full">Logout</button>

</div>
<!-- ===== HISTORY POPUP ===== -->
<div id="historyModal" class="dep-modal">
  <div class="dep-box">
<h3 class="dep-title">üìú Commission History</h3>
    <button id="closeHistory" class="close-ref">Close</button>

  </div>
</div>
<!-- ===== REFERRAL POPUP ===== -->
<div id="referralModal" class="ref-modal">
  <div class="ref-box">

    <h3 class="ref-title">üë• Referral Team & Commission</h3>
    <p class="ref-sub">Share this link to grow your team.</p>

    <label class="ref-label">Your Referral Link</label>
    <div class="ref-link">
      <input type="text" id="refInput" readonly>
      <button class="copy-btn" id="copyReferral">Copy</button>
    </div>

    <button id="closeReferral" class="close-ref">Close</button>

  </div>
</div>
<!-- ===== DEPOSIT POPUP ===== -->
<div id="depositModal" class="dep-modal">
  <div class="dep-box">
    <button class="status-btn">Status</button>
    <h3 class="dep-title">üí∞ Deposit Chips</h3>

    <div class="dep-field">
      <label>Amount (PTS)</label>
      <select>
        <option>50 PTS</option>
        <option>100 PTS</option>
        <option>300 PTS</option>
        <option>500 PTS</option>
        <option>1000 PTS</option>
        <option>2000 PTS</option>
        <option>3000 PTS</option>
        <option>5000 PTS</option>
      </select>
    </div>

    <div class="dep-field">
      <label>Wallet (Send To)</label>
      <select id="walletSelect">
        <option value="jazz">JazzCash</option>
        <option value="easy">Easypaisa</option>
      </select>
    </div>

    <div class="dep-field">
      <label>Wallet Number (Send To)</label>
      <div class="wallet-row">
        <input id="walletNumber" type="text" value="03090447488" readonly>
        <button class="copy-btn" onclick="copyDepositNumber()">Copy</button>
      </div>
    </div>

    <div class="dep-field">
  <label>Wallet Owner Name (Sent From)</label>
  <input type="text" id="senderName" placeholder="Enter wallet owner name">
</div>

    <div class="dep-field">
  <label>Your Wallet Number (Sent From)</label>
  <input type="text" id="senderNumber" placeholder="Enter your wallet number">
</div>

    <div class="dep-actions">
      <button class="confirm-btn" id="depositConfirmBtn">Confirm Request</button>
      <button id="closeDeposit" class="cancel-btn">Cancel</button>
    </div>

  </div>
</div>
<!-- ===== WITHDRAW POPUP ===== -->
<div id="withdrawModal" class="dep-modal">
  <div class="dep-box">
<button class="status-btn">Status</button>
    <h3 class="dep-title">üí∏ Withdraw Funds</h3>

    <p style="color:red;font-size:13px;font-weight:700;margin-bottom:10px;">
      Minimum withdrawal: 10 pts
    </p>

    <div class="dep-field">
      <label>Amount (Min 10 pts)</label>
      <input type="number" placeholder="Enter amount">
    </div>

    <div class="dep-field">
      <label>Withdraw Method</label>
      <select>
        <option>JazzCash</option>
        <option>EasyPaisa</option>
      </select>
    </div>

    <div class="dep-field">
      <label>Wallet Owner Name</label>
      <input type="text" placeholder="Enter your registered name">
    </div>

    <div class="dep-field">
      <label>Account Number (JazzCash / EasyPaisa)</label>
      <input type="text" placeholder="Enter 11 digit account number">
    </div>

    <div class="dep-actions">
      <button class="confirm-btn">Request Withdraw</button>
      <button id="closeWithdraw" class="cancel-btn">Cancel</button>
    </div>

  </div>
</div>
<script>
document.getElementById("openReferral").onclick = function () {
  document.getElementById("referralModal").style.display = "flex";
};

document.getElementById("closeReferral").onclick = function () {
  document.getElementById("referralModal").style.display = "none";
};
/* ===== COPY REFERRAL LINK (FIXED) ===== */
document.getElementById("copyReferral").onclick = function () {
  const btn = this;
  const input = document.querySelector(".ref-link input");

  navigator.clipboard.writeText(input.value).then(() => {
    btn.innerText = "Copied ‚úì";

    setTimeout(() => {
      btn.innerText = "Copy";
    }, 1000);
  });
};
</script>

<script>
/* OPEN DEPOSIT */
document.getElementById("openDeposit").onclick = function () {
  document.getElementById("depositModal").style.display = "flex";
};

/* CLOSE DEPOSIT */
document.getElementById("closeDeposit").onclick = function () {
  document.getElementById("depositModal").style.display = "none";
};

/* AUTO CHANGE NUMBER */
document.getElementById("walletSelect").onchange = function () {
  const num = document.getElementById("walletNumber");
  if(this.value === "jazz"){
    num.value = "03090447488";
  }else{
    num.value = "03008775258";
  }
};

/* COPY NUMBER (REPEATABLE) */
function copyDepositNumber(){
  const input = document.getElementById("walletNumber");
  input.select();
  input.setSelectionRange(0,99999);
  navigator.clipboard.writeText(input.value);
}
/* OPEN HISTORY */
document.getElementById("openHistory").onclick = function () {
  document.getElementById("historyModal").style.display = "flex";
};

/* CLOSE HISTORY */
document.getElementById("closeHistory").onclick = function () {
  document.getElementById("historyModal").style.display = "none";
};
/* OPEN WITHDRAW */
document.querySelector(".orange-btn").onclick = function () {
  document.getElementById("withdrawModal").style.display = "flex";
};

/* CLOSE WITHDRAW */
document.getElementById("closeWithdraw").onclick = function () {
  document.getElementById("withdrawModal").style.display = "none";
};
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import {
    getFirestore,
    doc,
    getDoc,
    updateDoc,
    Timestamp,
    addDoc,
    collection
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAuzjRv0Q1N4az6WPAQpGffAtZGT3Z-GxA",
    authDomain: "powermax-3ea77.firebaseapp.com",
    projectId: "powermax-3ea77",
    storageBucket: "powermax-3ea77.firebasestorage.app",
    messagingSenderId: "382941878878",
    appId: "1:382941878878:web:4472ab183d1534077732cf"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const PLANT_DURATION_DAYS = 15;

  function resetAllButtons() {
    document.querySelectorAll(".activate").forEach(btn => {
      btn.innerText = "Activate";
      btn.disabled = false;
      btn.style.background = "rgba(255,255,255,0.25)";
    });
  }

  function markButtonActive(btn) {
    btn.innerText = "Activated";
    btn.disabled = true;
    btn.style.background = "#22c55e";
  }

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "index.html";
      return;
    }

    const userRef = doc(db, "users", user.uid);
    const snap = await getDoc(userRef);
    if (!snap.exists()) return;

    const data = snap.data();

    // üë§ USER INFO
    document.getElementById("uName").innerText = data.name;
    document.getElementById("uBalance").innerText = data.balance + " PTS";
    document.getElementById("uID").innerText = data.uid;

    // üîó User ka apna referral link
    const myRefLink = `https://powermaxearning.github.io/powermax/?ref=${data.uid}`;
    document.getElementById("refInput").value = myRefLink;

    // ‚è±Ô∏è EXPIRE CHECK
    if (data.activePlant?.expiresAt) {
      const now = Date.now();
      const exp = data.activePlant.expiresAt.toMillis();
      if (now > exp) {
        await updateDoc(userRef, { activePlant: null });
        resetAllButtons();
        data.activePlant = null;
      }
    }

    // ‚úÖ ACTIVE PLANT BUTTON
    if (data.activePlant?.amount) {
      const btn = document.querySelector(`.activate[data-amount="${data.activePlant.amount}"]`);
      if (btn) markButtonActive(btn);
    }

    // üîò ACTIVATE CLICK
    document.querySelectorAll(".activate").forEach(btn => {
      btn.onclick = async () => {
        if (data.activePlant) {
          alert("Your plant is already active.");
          return;
        }

        const amount = Number(btn.dataset.amount);
        if (Number(data.balance) < amount) {
          alert("Insufficient balance.");
          return;
        }

        const now = Timestamp.now();
        const expires = Timestamp.fromMillis(
          now.toMillis() + PLANT_DURATION_DAYS * 24 * 60 * 60 * 1000
        );

        // Update user balance & active plant
        await updateDoc(userRef, {
          balance: Number(data.balance) - amount,
          activePlant: {
            amount,
            activatedAt: now,
            expiresAt: expires
          }
        });

// ===== REFERRAL TRACK + COMMISSION SYSTEM (WITH ACTIVE PLANT CHECK) =====
try {
  if (data.referredBy) {
    const referrerRef = doc(db, "users", data.referredBy);
    const refSnap = await getDoc(referrerRef);

    if (refSnap.exists()) {
      const refData = refSnap.data();
      const now = Timestamp.now();

      // ‚úÖ Only give commission if referrer's plant is active
      if (refData.activePlant && refData.activePlant.expiresAt.toMillis() > now.toMillis()) {
        const commission = Math.floor(amount * 0.90);

        // Update referral count & list
        await updateDoc(referrerRef, {
          refCount: (refData.refCount || 0) + 1,
          referrals: [...(refData.referrals || []), data.uid]
        });

        // Save commission record
        await addDoc(collection(db, "commissions"), {
          fromUser: data.uid,
          toUser: data.referredBy,
          amount: commission,
          plantAmount: amount,
          createdAt: now,
          status: "pending"
        });

        // Update referrer balance
        const newBalance = (refData.balance || 0) + commission;
        await updateDoc(referrerRef, { balance: newBalance });

        console.log("Referral + Commission Saved");
      } else {
        console.log("Referrer's plant inactive ‚Äì commission not added");
      }
    }
  }
} catch (err) {
  console.error("Referral Error:", err);
  alert("Referral Error: " + err.message);
}

        // Update local data
        data.balance = Number(data.balance) - amount;
        data.activePlant = { amount, expiresAt: expires };
        document.getElementById("uBalance").innerText = data.balance + " PTS";
        markButtonActive(btn);

        alert("Plant Activated Successfully!");
      };
    });
  });
  // ===== DEPOSIT REAL SYSTEM =====

const depositBtn = document.getElementById("depositConfirmBtn");

depositBtn.addEventListener("click", async () => {

  const amount = document.querySelector("#depositModal select").value;
  const walletType = document.getElementById("walletSelect").value;
  const adminWallet = document.getElementById("walletNumber").value;

  const senderName =
document.getElementById("senderName").value.trim();

const senderNumber =
document.getElementById("senderNumber").value.trim();

  if (!senderName || !senderNumber) {
    alert("Please fill all fields");
    return;
  }

  const user = auth.currentUser;

  if (!user) {
    alert("Login again");
    return;
  }

  try {

    await addDoc(collection(db, "deposits"), {

      uid: user.uid,
      name: document.getElementById("uName").innerText,

      amount: amount,
      walletType: walletType,
      adminWallet: adminWallet,

      senderName: senderName,
      senderNumber: senderNumber,

      status: "pending",
      createdAt: Timestamp.now()

    });

    alert("‚úÖ Deposit Request Sent!");

    // Clear inputs
    document.getElementById("senderName").value = "";
document.getElementById("senderNumber").value = "";

    // Close modal
    document.getElementById("depositModal").style.display = "none";

  } catch (err) {

    alert("‚ùå Deposit Error: " + err.message);

  }

});
</script>

<script type="module">
import {
  collection,
  addDoc,
  Timestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const auth = getAuth();
const db = getFirestore();

// Withdraw Confirm Button
const withdrawBtn = document.querySelector("#withdrawModal .confirm-btn");

withdrawBtn.addEventListener("click", async () => {

  const amount = document.querySelector('#withdrawModal input[type="number"]').value;
  const method = document.querySelector('#withdrawModal select').value;
  const ownerName = document.querySelectorAll('#withdrawModal input[type="text"]')[0].value.trim();
  const accountNumber = document.querySelectorAll('#withdrawModal input[type="text"]')[1].value.trim();

  if (!amount || amount < 10 || !ownerName || !accountNumber) {
    alert("‚ùå Please fill all fields (Min 10 PTS)");
    return;
  }

  const user = auth.currentUser;
  if (!user) {
    alert("Login required");
    return;
  }

  try {
    await addDoc(collection(db, "withdraws"), {
      uid: user.uid,
      name: document.getElementById("uName").innerText,
      amount: Number(amount),
      method: method,
      ownerName: ownerName,
      accountNumber: accountNumber,
      status: "pending",
      createdAt: Timestamp.now()
    });

    alert("‚úÖ Withdraw Request Sent!");

    // Clear fields
    document.querySelector('#withdrawModal input[type="number"]').value = "";
    document.querySelectorAll('#withdrawModal input[type="text"]')[0].value = "";
    document.querySelectorAll('#withdrawModal input[type="text"]')[1].value = "";

    // Close modal
    document.getElementById("withdrawModal").style.display = "none";

  } catch (err) {
    alert("‚ùå Withdraw Error: " + err.message);
  }
});
</script>

<!-- üî¥ LOGOUT SYSTEM -->
<script type="module">
import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const auth2 = getAuth();

// LOGOUT BUTTON
document.querySelector(".red-btn").addEventListener("click", async () => {
  try {
    await signOut(auth2);
    alert("Logout Successful!");
    window.location.href = "index.html";
  } catch (e) {
    alert("Logout Error: " + e.message);
  }
});
</script>

</body>
 </html>
