<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PowerMax</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{background:#020617;color:white;font-family:system-ui;display:flex;justify-content:center;align-items:center;height:100vh}
.card{background:#111827;padding:30px;border-radius:20px;text-align:center}
button{padding:15px 30px;border:none;border-radius:12px;font-size:16px;font-weight:bold;background:white;color:black}
small{color:#94a3b8}
</style>
</head>
<body>

<div class="card">
<h2>âš¡ PowerMax Rewards Platform</h2>
<p>Play & earn promotional points</p>
<button id="login">Sign in with Google</button>
<br><br>
<small>Points have no real cash value</small>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc, increment, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
 apiKey: "AIzaSyAuzjRv0Q1N4az6WPAQpGffAtZGT3Z-GxA",
 authDomain: "powermax-3ea77.firebaseapp.com",
 projectId: "powermax-3ea77"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();
const db = getFirestore(app);

const ref = new URLSearchParams(location.search).get("ref");

document.getElementById("login").onclick = async()=>{
 const r = await signInWithPopup(auth, provider);
 const u = r.user;
 const userRef = doc(db,"users",u.uid);
 const snap = await getDoc(userRef);

 if(!snap.exists()){
  await setDoc(userRef,{
   uid:u.uid,
   name:u.displayName,
   email:u.email,
   balance:0,
   spins:5,
   refCount:0,
   referredBy:ref||null,
   createdAt:serverTimestamp()
  });

  if(ref){
   await updateDoc(doc(db,"users",ref),{refCount:increment(1)});
  }
 }

 localStorage.setItem("uid",u.uid);
 location.href="dashboard.html";
};
</script>

</body>
</html>
